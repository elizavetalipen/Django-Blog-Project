{% extends 'base.html' %}

{% block content %}
    <div class="row">
        <div class="col-md-8 col-sm 12">
            <div class="post">
                <img src="/media/{{ post.post_image }}" 
                class="card-img-top img-fluid" style="width:100%; height:80%;
                 object-fit: cover; object-position: center;">
                <h1 class="mt-3">{{ post.title }}</h1>
                <div class="post-meta">
                    <p>
                        <i class="bi bi-person"></i>
                        <a href="{% url 'profile' pk=post.user.pk %}">
                            {{ post.user.username }}</a>
                        {{ post.published|date:"F d, Y" }},
                    </p>
                    <div class="post-tags">
                        {% for tag in tags %}
                            <p style="color: rgb(60, 47, 75);
                            display: inline-block;">#{{ tag.tag.title }}</p>
                        {% endfor %}
                    </div>
                    {% if request.user == post.user %}
                        <a href="{% url 'edit_post' post.pk %}" class="btn btn-primary">
                            Edit <i class="bi bi-pencil-square"></i>
                        </a>
                        <a href="{% url 'delete_post' pk=post.pk %}" class="btn btn-danger" 
                        id="delete-btn">Delete</a>

                        {% endif %}
                </div>
                <p class="mt-4">{{ post.content|linebreaksbr }}</p>
            </div>
        </div>
        <!-- комментарии -->
        <div class="col-md-4 col-sm-12">
            <div class="mt-4">
              {% if user.is_authenticated %}
                <h4>Write a comment</h4>
                <form method="post">
                  {% csrf_token %}
                  {{ form.as_p }}
                  <div class="form-group">
                    <button type="submit" class="btn btn-primary">Save</button>
                  </div>
                </form>
              {% else %}
                <p><a href="{% url 'login' %}">Log in</a> to comment this post</p>
              {% endif %}
            </div>
            <div class="mt-4">
              <h4>Comments</h4>
              {% if post.comment_set.exists %}
                {% for comment in post.comment_set.all %}
                  <div class="card mb-2">
                    <div class="card-body">
                      <h6 class="card-subtitle mb-2 text-muted">{{ comment.user.username }} 
                        {% if request.user == comment.user %}
                          <a href="{% url 'edit_comment' pk=comment.pk %}">
                            <i class="bi bi-pencil-square"></i></a>
                          <a href="{% url 'delete_comment' pk=comment.pk %}">
                            <i class="bi bi-trash"></i></a>
                        {% endif %}
                        <!--<small>{{ comment.published|date:"F d, Y" }}</small>-->
                        </h6>
                        <p class="card-text">{{ comment.content }}</p>
                    </div>
                </div>
            {% endfor %}
            {% else %}
            {% endif %}
            </div>
        </div>
    </div>
{% endblock %}